<template name="specificListingEdit">
  <div id="content">
    <div class="container">

        <div class="col-md-12">
          <div class="box text-center">
            <div class="row">
              <div class="col-sm-10 col-sm-offset-1">
		{{#if newListing}}
                <h1>{{t "Add new listing"}}</h1>	    
		<button class="btn btn-danger cancelEditListing">{{t "Cancel & don't save"}}</button>
		{{else}}
                <h1>{{t "Edit listing"}}</h1>	    
		<button class="btn btn-danger cancelEditListing">{{t "Cancel & don't save"}}</button>
		{{/if}} 
              </div>
            </div>
          </div>
        </div>
      
	<div class="col-md-8 col-md-offset-2 clearfix">
	  <div class="box" id="text-page">
	    {{#if newListing}}
	    
	    {{#autoForm schema=listingSchema id="specificListingCreate" type="method" meteormethod="createNewListing"}}
	    <div>{{flash 'listingSaved'}}</div>

	    <!-- listing type & listing category START-->
	    <label class="control-label">{{t "Select listing type"}}:</label><br>
	    <select id="listingType" class="form-control input-sm">
	      {{#each listingTypes}}
	      <option value={{listingType}} {{ifSelected}}> {{listingType}} </option>
	      {{/each}}
	    </select>
	    <br>
	    {{#if ifCategorySelectedHasSub}}
	    <div class="row">	    
	      <div class="col-md-6">
		<label class="control-label">{{t "Select listing category"}}:</label><br>
		<select id="listingCategory" class="form-control input-sm">
		  <option value="" {{ifCategorySelected}}> {{t "Not selected"}} </option>
		  {{#each listingParentCategories}}
		  <option value={{name}} {{ifCategorySelected}}> {{name}} </option>
		  {{/each}}
		</select>
	      </div>
	      <div class="col-md-6">
		<label class="control-label">{{t "Select listing subcategory"}}:</label><br>
		<select id="listingSubCategory" class="form-control input-sm">
		  <option value="" {{ifSubCategorySelected}}> {{t "Not selected"}} </option>
		  {{#each listingChildrenCategories}}
		  <option value={{name}} {{ifSubCategorySelected}}> {{name}} </option>
		  {{/each}}
		</select>
	      </div>
	    </div>
	    {{else}}
	    <label class="control-label">{{t "Select listing category"}}:</label><br>
	    <select id="listingCategory" class="form-control input-sm">
	      <option value="" {{ifCategorySelected}}> {{t "Not selected"}} </option>
	      {{#each listingParentCategories}}
	      <option value={{name}} {{ifCategorySelected}}> {{name}} </option>
	      {{/each}}
	    </select>
	    {{/if}}
	    <br>
	    <!-- listing type & listing category END -->

	    <fieldset>
	      {{> afQuickField name='image'}}
	      {{> afQuickField name='title'}}
	      {{> afQuickField name='description'}}
	      {{> afQuickField name='details' rows=5}}
	      <div class="col-md-4">
		{{> afQuickField name='price'}}
	      </div>
	      <div class="col-md-4">
		{{> afQuickField name='shippingFee'}}
	      </div>
	      <div class="col-md-4">
		{{> afQuickField name='tax'}}
	      </div>
	      <div class="form-group{{#if afFieldIsInvalid name='tags'}} has-error{{/if}}">
		<label class="control-label">{{t "Tags"}}</label><br>
		{{> afFieldInput name='tags' type='text' id='tokenfield'}}
		{{#if afFieldIsInvalid name='tags'}}
		<span class="help-block">{{afFieldMessage name='tags'}}</span>
		{{/if}}
	      </div>
	      {{#each customFields}}
	      {{> afQuickField name=this.name options=afOptionsFromSchema}}
	      {{/each}}
	      
	      {{> afQuickField name='isRibbonSale'}}
	      {{> afQuickField name='isRibbonNew'}}
	      {{> afQuickField name='isPublic'}}
	      {{> afQuickField name='active'}}
	      
              {{> afFieldInput type="hidden" name="listingType" value=listingTypeGet}}
 	    </fieldset>
	    <button type="submit" class="btn btn-primary">{{t "Save"}}</button>
<!--	    <button type="reset" class="btn btn-default">{{t "Reset"}}</button> -->
	    <button class="btn btn-danger cancelEditListing">{{t "Cancel & don't save"}}</button>
	    {{/autoForm}}
	    
	    {{else}}
	    
	    {{#autoForm collection="Listings" id="specificListingEdit" type="update" doc=currentListing}}
	    <div>{{flash 'listingSaved'}}</div>

	    <!-- listing type & listing category START-->
	    <label class="control-label">{{t "Select listing type"}}:</label><br>
	    <select id="listingType" class="form-control input-sm">
	      {{#each listingTypes}}
	      <option value={{listingType}} {{ifSelected}}> {{listingType}} </option>
	      {{/each}}
	    </select>
	    <br>
	    {{#if ifCategorySelectedHasSub}}
	    <div class="row">	    
	      <div class="col-md-6">
		<label class="control-label">{{t "Select listing category"}}:</label><br>
		<select id="listingCategory" class="form-control input-sm">
		  <option value="" {{ifCategorySelected}}> {{t "Not selected"}} </option>
		  {{#each listingParentCategories}}
		  <option value={{name}} {{ifCategorySelected}}> {{name}} </option>
		  {{/each}}
		</select>
	      </div>
	      <div class="col-md-6">
		<label class="control-label">{{t "Select listing subcategory"}}:</label><br>
		<select id="listingSubCategory" class="form-control input-sm">
		  <option value="" {{ifSubCategorySelected}}> {{t "Not selected"}} </option>
		  {{#each listingChildrenCategories}}
		  <option value={{name}} {{ifSubCategorySelected}}> {{name}} </option>
		  {{/each}}
		</select>
	      </div>
	    </div>
	    {{else}}
	    <label class="control-label">{{t "Select listing category"}}:</label><br>
	    <select id="listingCategory" class="form-control input-sm">
	      <option value="" {{ifCategorySelected}}> {{t "Not selected"}} </option>
	      {{#each listingParentCategories}}
	      <option value={{name}} {{ifCategorySelected}}> {{name}} </option>
	      {{/each}}
	    </select>
	    {{/if}}
	    <br>
	    <!-- listing type & listing category END -->

	    <fieldset>
	      {{> afQuickField name='image'}}
	      {{> afQuickField name='title'}}
	      {{> afQuickField name='description'}}
	      {{> afQuickField name='details' rows=3}}
	      <div class="col-md-4">
		{{> afQuickField name='price'}}
	      </div>
	      <div class="col-md-4">
		{{> afQuickField name='shippingFee'}}
	      </div>
	      <div class="col-md-4">
		{{> afQuickField name='tax'}}
	      </div>
	      {{> afQuickField name='tags' type='text' id='tokenfield'}}
	      <div class="form-group">
		<label class="control-label">{{t "Listing url"}}</label>
		<input type="text" class="form-control" readonly value="{{appUrl}}listing/{{currentListing.uri}}">
	      </div>
	      {{#each customFields}}
	      {{> afQuickField name=this.name options=afOptionsFromSchema}}
	      {{/each}}

	      {{> afQuickField name='isRibbonSale'}}
	      {{> afQuickField name='isRibbonNew'}}
	      {{> afQuickField name='isPublic'}}
	      {{> afQuickField name='active'}}

              {{> afFieldInput type="hidden" name="listingType" value=listingTypeGet}}
	      
	    </fieldset>
	    <button type="submit" class="btn btn-primary">{{t "Save"}}</button>
<!--	    <button type="reset" class="btn btn-default">{{t "Reset"}}</button> -->
	    <button class="btn btn-danger cancelEditListing">{{t "Cancel & don't save"}}</button>
	    {{/autoForm}}
	    
	    {{/if}}
	  </div>      
	</div>
    </div>
  </div>
</template>
