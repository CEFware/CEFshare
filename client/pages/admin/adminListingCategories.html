<template name="adminListingCategories">
  <div class="row inner-page admin-dashboard">
    <div class="col s12">
      <h4>{{t "Categories"}}</h4>
    </div>

    <div class="col s12">
      <h5>{{t "Listing categories & subcategories"}}</h5> <br>
    </div>

    <div class="col s12">
      <table class="bordered">
	{{#each categoriesParents}}
	<tr>
	  <td colspan="2">
            {{#if editingCategory _id}}
            {{> editCategoryName}}
            {{else}}
            <b>{{name}}</b>
            {{/if}}
	  </td>
	  <td>
            <span class="label label-default">{{countArr listings}}</span>&nbsp;
	  </td>
	  <td>
            {{#if editingCategory _id}}
            <i class="fa fa-pencil"></i>&nbsp;
            {{else}}
            <a href="#"><i class="fa fa-pencil"></i></a>&nbsp;
            {{/if}}
	  </td>
	  <td>
            {{#if letDelete this}}
            <a href="#" class="adminListingCategoryDelete"><i class="fa fa-trash"></i></a>
            {{else}}
            <i class="fa fa-trash"></i>
            {{/if}}
	  </td>
        </tr>
        {{#each categoriesChildren}}
	<tr>
	  <td>&nbsp;</td>
	  <td>
            {{#if editingCategory _id}}
            {{> editCategoryName}}
            {{else}}
            {{name}}
            {{/if}}
	  </td>
	  <td>
            <span class="label label-default">{{countArr listings}}</span>&nbsp;
	  </td>
	  <td>
            {{#if editingCategory _id}}
            <i class="fa fa-pencil"></i>&nbsp;
            {{else}}
            <a href="#"><i class="fa fa-pencil"></i></a>&nbsp;
            {{/if}}
	  </td>
	  <td>
            {{#if letDelete this}}
            <a href="#" class="adminListingCategoryDelete"><i class="fa fa-trash"></i></a>
            {{else}}
            <i class="fa fa-trash"></i>
            {{/if}}
	  </td>
	</tr>
        {{/each}}
	{{/each}}
      </table>
    </div>

    <div class="col s12">
      <h5>{{t "Add new category"}}</h5> <br>
    </div>

    <div class="col s12">
      {{#autoForm schema=categoriesSchemaObj id="adminListingCategories" type="method" meteormethod="saveAdminListingCategories"}}
      <div>

        {{> afQuickField name="name"}}
        {{> afQuickField name="parent"}}

        <div class="col s12">
            <br><br>
          <button type="submit" class="btn"> <i class="mdi-navigation-check left"></i> {{t "Save"}}</button>
          <button type="reset" class="btn-flat red-text"><i class="mdi-navigation-close left"></i> {{t "Reset"}}</button>
        </div>
      </div>
      {{/autoForm}}
 
    </div>

  </div>

</template>

<template name = "editCategoryName">
  <form>
    <div class="input-group input-group-sm">
      <input type="text" class="form-control newCatName" value="{{name}}" id="{{_id}}">
      <span class="input-group-btn">
	<button class="btn btn-primary saveEdit" type="submit">{{t "SAVE"}}</button>
	<button class="btn btn-danger stopEdit red"><i class="mdi-navigation-close left"></i></button>
      </span>
    </div>
  </form>
</template>
